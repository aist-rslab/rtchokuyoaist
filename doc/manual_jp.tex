\documentclass[a4paper,10pt]{article}

\usepackage{CJKutf8}
% \usepackage[UKenglish]{babel}
\usepackage[overlap, CJK]{ruby}
\usepackage{CJKulem}

\renewcommand{\rubysep}{-0.2ex}
\newenvironment{Japanese}{%
  \CJKfamily{min}%
  \CJKtilde
  \CJKnospace}{}

\usepackage{listings}
\usepackage{a4wide}
\usepackage{tabularx}
\usepackage{booktabs}

\lstloadlanguages{Bash}
\lstset{basicstyle=\small\ttfamily, escapeinside={(*@}{@*)},
showstringspaces=false, breaklines=true, breakatwhitespace=true,
tabsize=4, language=Bash, numberfirstline=true,
commentstyle=\itshape\color{CommentGreen},
stringstyle=\color{DataTypeBlue}}
\newcommand{\ilcode}[1]{\lstinline|#1|}

\title{RTC:HokuyoAist}
\author{Geoffrey Biggs (ジェフ・ビグズ)\\
geoffrey.biggs@aist.go.jp}

\begin{document}
\begin{CJK}{UTF8}{}
\begin{Japanese}

\maketitle

\section{はじめに}
\label{sec:intro}

RTC:HokuyoAistはOpenRTM-aist用のRTコンポーネントです。北陽電機株式会社製のレーザーセンサーのドライバを
提供します。Gearbox\footnote{http://gearbox.sourceforge.net/}で提供されているhokuyo\_aistライブラリをラップしてます。URG-04LX（Classic-URG）、
UGH-08LX（Hi-URG）、UTM-30LX（Top-URG）、UXM-30LX（Tough-URG）及びUXM-30LX-Eを
含むレーザーセンサーの、すべての現在のモデルで機能します。

RTC:HokuyoAistのコンポーネントが活性化されるまで、レーザーは起動しません。
その後、コンポーネントがpullモードではない構成の場合、レーザーを起動できます。起動時に、レーザーの内部
クロックは、コンピューターのクロック（コミュニケーション遅れを含む）で測定されます。
データのタイムスタンプはこの測定された時間を使用して計算されます。
したがって、ユーザーはデータの測定を行う必要はありません。

このソフトウェアは新エネルギー・産業技術総合開発機構（NEDO)の支援により、産業技術総合研究所で開発されて
います。承認番号はH22PRO-1167です。
このソフトウェアはEclipse Public License -v 1.0 (EPL)ライセンスとして公開されてます。LICENSE.txtを参照してください。

\section{条件}
\label{sec:requirements}

RTC:HokuyoAistはGearboxが提供しているhokuyo\_aistライブラリを使います。バージョン2.0.0以上が必要
です\footnote{Gearbox 10.11にあります。}。
このライブラリはWindows用のインストーラに含まれています。

RTC:HokuyoAistはOpenRTM-aistのC++版が必要です。

RTC:StageはCMake\footnote{http://www.cmake.org/}を使います。CMake
2.6以上が必要です。

RTC:HokuyoAistはWindows、Linux及びMacOS Xで使うことができます。レーザーとの
コミュニケーションはGearboxの「flexiport」というライブラリを使います。このライブラリを
インストールしなければなりません。このライブラリはWindows用のインストーラに含まれています。

\section{インストール}
\label{sec:installation}

\subsection{インストーラ}

Windowsのユーザはインストーラパッケージを使用してコンポーネントをインストールすることができます。
これはコンポーネント及びそのすべての必要なライブラリをインストールします。Windowsでインストール
する場合、インストーラの使用を推奨してます。

\begin{enumerate}
  \item インストーラをダウンロードしてください。
  \item インストールを始めるためにインストーラをダブルクリックしてください。
  \item 指示にしたがってコンポーネントをインストールしてください。
  \item 環境変数の変更を適用するため、コンポーネントを使用する前にコンピューターを再起動する
必要があるかもしれません。
\end{enumerate}

RTC:HokuyoAistは\verb|rtchokuyoaist_standalone|の実行をダブルクリックして実行することが
できます。あるいは、\verb|rtc_hokuyoaist|を初期化関数の\verb|rtc_init|を利用して、
マネージャにロードすることができます。

\subsection{ソースから}

ソースを使う場合は以下の手順でインストールしてください。

\begin{enumerate}
  \item ソースをダウンロードして解凍してください。

  \verb|tar -xvzf rtchokuyoaist-2.0.0.tar.gz|
  \item 解凍されたフォルダに入ってください。

  \verb|cd rtchokuyoaist-2.0.0|
  \item ``build''フォルダを作ってください。

  \verb|mkdir build|
  \item ``build''フォルダに入ってください。

  \verb|cd build|
  \item CMakeを実行してください。

  \verb|cmake ../|
  \item エラーが出無い場合、makeを実行してください。

  \verb|make|
  \item make
  installでコンポーネントをインストールしてください。選択されたインストール
  場所に書き込み権限があるかを確認してください。

  \verb|make install|
  \item
  インストールする場所はccmakeを実行して\verb|CMAKE_INSTALL_PREFIX|を
  設定することで変更が可能です。

  \verb|ccmake ../|
\end{enumerate}

ここまでで、コンポーネントが使えるようになりました。コンフィグレーションは次のセクションを
参照してください。

RTC:HokuyoAistは\verb|rtchokuyoaist_standalone|を実行（\verb|${prefix}/bin|に
インストールされます）することでスタンドアローンモードで実行することができます。
あるいは、\verb|librtchokuyoaist.so|を初期化関数の\verb|rtc_init|を利用して、
マネージャにロードすることができます。このライブラリは\verb|${prefix}/lib|
または\verb|${prefix}/lib64|にインストールされます。

\section{コンフィグレーション}
\label{sec:configuration}

使えるコンフィグレーションパラメータはテーブル~\ref{tab:config_params}を参照
してください。

\begin{table}[t]
  \centering
  \begin{tabularx}{\columnwidth}{lX}
    \toprule
    パラメータ & 意味 \\
    \midrule
    port\_opts & レーザーのためのポートを開くために使用されるオプションを変更します。詳細についてはflexiportの説明書を参照してください。 \\
    start\_angle & スキャン開始角度です。ラジアンで指定してください。全スキャンのためにデフォルトでは0に設定してください。 \\
    end\_angle & スキャン終了角度です。ラジアンで指定してください。全スキャンのためにデフォルトでは0に設定してください。 \\
    cluster\_count & クラスタサイズです。デフォルトは１です。 \\
    enable\_intensity & Trueに設定された場合、インテンシティデータも送られます。 \\
    high\_sensitivity & いくつかのモデルは高感度モードをサポートします。それを可能にするためにこのパラメータを設定してください。 \\
    pull\_mode & pullモードに変わります。サービスポートを通ってスキャンの要求が必要になります。 \\
    new\_data\_mode & Trueに設定された場合、毎回のスキャンで新しいデータを要求します。そうではなければ、最も最新のデータが送られます。 \\
    error\_time & エラー間の最小の時間(秒)です。エラーがこの値より小さい間隔で生じた場合、コンポーネントはエラーに遷移します。そうでなければ、レーザーをリセットし、継続することを試みます。 \\
    x, y, z & レーザーの3次元位置です。 \\
    roll, pitch, yaw & レーザーの3次元角度です。 \\
    \bottomrule
  \end{tabularx}
  \caption{コンフィグレーションパラメータ。}
  \label{tab:config_params}
\end{table}

\section{ポート}
\label{sec:port}

コンポーネントによって提供されるポートはテーブル~\ref{tab:ports}で述べられています。

北洋電機のレーザープロトコルは、20未満の値を使用して、データ内でエラーを報告します。
コンポーネントはこれらの値を0ｍに取り替えます。データを処理する場合、unknownとして全てゼロの値を
考慮してください。

\begin{table}[t]
  \centering
  \begin{tabularx}{\columnwidth}{lllX}
    \toprule
    ポート名 & ポート型 & データ型 & 意味 \\
    \midrule
    ranges & OutPort & RTC::RangeData & レンジデータ \\
    intensities & OutPort & RTC::IntensityData & インテンシティデータ。インテンシティデータが可能になる場合のみ利用可能です。 \\
    ranger & Service & Ranger & RTC:Rangerインターフェースを提供しているサービスポートです。 \\
    & & HokuyoAist & HokuyoAistインターフェースを提供しているサービスポートです。 \\
    \bottomrule
  \end{tabularx}
  \caption{コンポーネントのポート。}
  \label{tab:ports}
\end{table}

\section{例}
\label{sec:examples}

例のrtc.confファイルは\verb|${prefix}/share/rtc_hokuyoaist/examples/conf/|
フォルダにインストールされています。

\section{Changelog}

\subsection{2.0}

\begin{itemize}
  \item Support hokuyo\_aist library v2 API.
\end{itemize}

\end{Japanese}
\end{CJK}
\end{document}

